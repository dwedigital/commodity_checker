<div class="md:flex md:items-center md:justify-between mb-8">
  <div class="min-w-0 flex-1">
    <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
      Product Lookups
    </h2>
    <p class="mt-1 text-sm text-gray-500">Your recent product commodity code lookups</p>
  </div>
  <div class="mt-4 flex md:ml-4 md:mt-0">
    <%= link_to new_product_lookup_path, class: "inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600" do %>
      <svg class="-ml-0.5 mr-1.5 size-5" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
      </svg>
      New Lookup
    <% end %>
  </div>
</div>

<% if @product_lookups.any? %>
  <div class="bg-white shadow rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Product</th>
          <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Retailer</th>
          <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Code</th>
          <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
          <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Date</th>
          <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
            <span class="sr-only">View</span>
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <% @product_lookups.each do |lookup| %>
          <tr>
            <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6">
              <div class="flex items-center">
                <% if lookup.image_url.present? %>
                  <div class="shrink-0 size-10 mr-3">
                    <img class="size-10 rounded object-contain bg-gray-100" src="<%= lookup.image_url %>" alt="">
                  </div>
                <% end %>
                <div class="max-w-xs">
                  <div class="font-medium text-gray-900 truncate"><%= lookup.title.presence || "Untitled" %></div>
                  <div class="text-gray-500 truncate text-xs"><%= truncate(lookup.url, length: 50) %></div>
                </div>
              </div>
            </td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
              <%= lookup.retailer_name&.titleize || "-" %>
            </td>
            <td class="whitespace-nowrap px-3 py-4 text-sm">
              <% if lookup.commodity_code_confirmed? %>
                <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
                  <%= lookup.confirmed_commodity_code %>
                </span>
              <% elsif lookup.suggested_commodity_code.present? %>
                <span class="inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">
                  <%= lookup.suggested_commodity_code %>
                </span>
              <% else %>
                <span class="text-gray-400">-</span>
              <% end %>
            </td>
            <td class="whitespace-nowrap px-3 py-4 text-sm">
              <% case lookup.scrape_status %>
              <% when "pending" %>
                <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">Processing</span>
              <% when "completed" %>
                <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">Complete</span>
              <% when "partial" %>
                <span class="inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">Partial</span>
              <% when "failed" %>
                <span class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">Failed</span>
              <% end %>
            </td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
              <%= lookup.created_at.strftime("%d %b %Y") %>
            </td>
            <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">
              <%= link_to "View", lookup, class: "text-indigo-600 hover:text-indigo-900" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="text-center bg-white rounded-lg shadow px-4 py-12">
    <svg class="mx-auto size-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
    <h3 class="mt-2 text-sm font-semibold text-gray-900">No lookups yet</h3>
    <p class="mt-1 text-sm text-gray-500">Get started by looking up a product.</p>
    <div class="mt-6">
      <%= link_to new_product_lookup_path, class: "inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500" do %>
        <svg class="-ml-0.5 mr-1.5 size-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
        </svg>
        New Lookup
      <% end %>
    </div>
  </div>
<% end %>
